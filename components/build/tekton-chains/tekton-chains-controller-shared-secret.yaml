---
# Mount the contents of the SharedSecret named redhat-appstudio-user-workload
# on the Tekton Chains controller at $DOCKER_CONFIG/config.json. This makes
# Chains consider those credentials when pushing content to an OCI repo.
apiVersion: apps/v1
kind: Deployment
metadata:
  name: tekton-chains-controller
  namespace: tekton-chains
spec:
  template:
    spec:
      containers:
      - name: tekton-chains-controller
        env:
        - name: DOCKER_CONFIG
          value: /secret/default-push-secret
        volumeMounts:
        - mountPath: /secret/default-push-secret/config.json
          subPath: .dockerconfigjson
          name: default-push-secret
      volumes:
      - name: default-push-secret
        csi:
          driver: csi.sharedresource.openshift.io
          readOnly: true
          volumeAttributes:
            sharedSecret: redhat-appstudio-user-workload
